(function(e){function t(t){for(var n,u,i=t[0],o=t[1],c=t[2],h=0,p=[];h<i.length;h++)u=i[h],a[u]&&p.push(a[u][0]),a[u]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);l&&l(t);while(p.length)p.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,i=1;i<r.length;i++){var o=r[i];0!==a[o]&&(n=!1)}n&&(s.splice(t--,1),e=u(u.s=r[0]))}return e}var n={},a={app:0},s=[];function u(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,u),r.l=!0,r.exports}u.m=e,u.c=n,u.d=function(e,t,r){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(u.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)u.d(r,n,function(t){return e[t]}.bind(null,n));return r},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],o=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=o;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"56d7":function(e,t,r){"use strict";r.r(t);r("96cf");var n=r("3b8d"),a=(r("cadf"),r("551c"),r("f751"),r("097d"),r("baf5"),r("2b0e")),s=r("8c4f"),u=r("5f5b"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("b-container",[r("b-navbar",{attrs:{toggleable:"md"}},[r("b-navbar-brand",{attrs:{to:"/"}},[r("img",{staticStyle:{height:"100px"},attrs:{src:"/static/img/logo_transparent.png",alt:"Linn's TV Search"}})]),r("b-navbar-toggle",{attrs:{target:"mainNav"}},[r("img",{attrs:{src:"/static/img/hamburger_icon.svg"}})]),r("b-collapse",{attrs:{"is-nav":"",id:"mainNav"}},[r("b-navbar-nav",[r("b-nav-item",{attrs:{to:"about"}},[e._v("About Us")]),r("b-nav-item",{staticClass:"nav-github-link",attrs:{href:"https://github.com/SimplyLinn/tvmaze-api-frontend"}},[r("img",{staticClass:"icon",attrs:{src:"/static/img/GitHub-Mark.png"}}),e._v(" Github")])],1)],1)],1),r("router-view")],1)],1)},o=[],c={name:"app"},l=c,h=r("2877"),p=Object(h["a"])(l,i,o,!1,null,null,null),f=p.exports,m=(r("9607"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-row",[r("b-form-input",{staticClass:"searchForm",attrs:{autocomplete:"off",placeholder:"Search for series"},on:{input:e.debounceInput,focus:e.onfocus}}),r("div",{staticClass:"searchResContainer"},[r("keep-alive",[e.hasFocus?r("search-results",{attrs:{searchQuery:e.searchQuery}}):e._e()],1)],1),r("div",[e._v("\n    Woaoeu\n  ")])],1)}),d=[],b=(r("386d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{staticClass:"searchbox"},[e.searchQuery.term?[r("b-row",[r("b-col",[e._v("Showing "+e._s(e.searchQuery.results.length+" result"+(1===e.searchQuery.results.length?"":"s"))+" for "),r("b",[e._v(e._s(e.searchQuery.term))]),e._v(" (query took "+e._s(e.searchQuery.time)+"ms)")])],1),r("result-list",{attrs:{results:e.searchQuery.results}})]:r("b-row",[e._v("\n    Start typing to search.\n  ")])],2)}),g=[],v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.results.length?r("div",e._l(e.results,function(t){var n=t.result;return r("b-row",{key:n.id},[r("b-col",[r("result-img",{attrs:{result:n}})],1),r("b-col",[e._v("\n      "+e._s(n.name)+"\n    ")])],1)}),1):r("div",[e._v("\n  NO RESULTS TO SHOW!\n")])},w=[],y=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("img",{attrs:{src:e.src,alt:e.result.name}})},k=[],x={name:"app",data:function(){return{src:"/static/img/logo_transparent.png"}},props:{result:Object},methods:{},mounted:function(){var e=this,t=this.result;t.thumbUrl?t.thumb?this.src=URL.createObjectURL(t.thumb):fetch(t.thumbUrl).then(function(r){r.blob().then(function(r){e.src=URL.createObjectURL(r),t.thumb=r,t.save()})}):this.src="/static/img/GitHub-Mark.png"}},O=x,j=Object(h["a"])(O,y,k,!1,null,null,null),U=j.exports,_={name:"app",data:function(){return{filterOpen:!1}},components:{"result-img":U},props:{results:Array},methods:{}},R=_,S=Object(h["a"])(R,v,w,!1,null,null,null),P=S.exports,W={name:"app",data:function(){return{filterOpen:!1}},components:{"result-list":P},props:{searchQuery:Object},methods:{}},C=W,E=Object(h["a"])(C,b,g,!1,null,null,null),Q=E.exports,T=(r("7514"),r("7f7f"),r("55dd"),r("28a5"),r("6762"),r("2fdb"),r("ac6a"),r("5df3"),r("c5f6"),r("04ff"),r("d225")),L=r("b0b4"),I=(r("8e6e"),r("456d"),r("7cdf"),r("7618")),q=r("bd86"),D=r("bc3a"),M=r.n(D),F=r("75fc");r("4f7f"),r("a481");function $(e){return new Promise(function(t){return setTimeout(t,e)})}function N(){return(new Date).getTime()}function A(e){var t=new Set;return e.toLowerCase().split(" ").forEach(function(e){return e&&t.add(e)}),Object(F["a"])(t)}function H(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(r,!0).forEach(function(t){Object(q["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var G=2e3,z=M.a.create({baseURL:"https://api.tvmaze.com/",timeout:5e3}),B=[],J=!1,V=function(){function e(){Object(T["a"])(this,e)}return Object(L["a"])(e,[{key:"doRequest",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:r=0;case 1:return e.prev=2,e.next=5,z.request(t);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e["catch"](2),e.t0.isAxiosError){e.next=12;break}throw e.t0;case 12:if(e.t0.response){e.next=14;break}throw e.t0;case 14:if(429===e.t0.response.status){e.next=16;break}throw e.t0;case 16:if(n=Math.min(10*G,Math.round(G*Math.pow(1.5,r))),r++,!(this.maxRetries&&r>=this.maxRetries)){e.next=20;break}throw e.t0;case 20:return console.log("We got ratelimited, waiting ".concat(n,"ms. We have tried ").concat(r," times.")),e.next=23,$(n);case 23:e.next=1;break;case 25:case"end":return e.stop()}},e,this,[[2,8]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"runQueue",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,r,n,a,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(J=!0,B.length){e.next=4;break}return J=!1,e.abrupt("return");case 4:t=B.pop(),r=t.config,n=t.resolve,a=t.reject,this.doRequest(r).then(n).catch(a).finally(function(){return s.runQueue()});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"request",value:function(e){var t=this,r=!1;return e.hasOwnProperty("priority")&&(r=e.priority,delete e.priority),new Promise(function(n,a){B[r?"push":"unshift"]({config:e,resolve:n,reject:a}),J||t.runQueue()})}},{key:"get",value:function(e,t){return this.request(K({url:e,method:"get"},t||{}))}},{key:"delete",value:function(e,t){return this.request(K({url:e,method:"delete"},t||{}))}},{key:"head",value:function(e,t){return this.request(K({url:e,method:"head"},t||{}))}},{key:"options",value:function(e,t){return this.request(K({url:e,method:"options"},t||{}))}},{key:"post",value:function(e,t,r){return this.request(K({url:e,method:"post",data:t},r||{}))}},{key:"put",value:function(e,t,r){return this.request(K({url:e,method:"put",data:t},r||{}))}},{key:"patch",value:function(e,t,r){return this.request(K({url:e,method:"patch",data:t},r||{}))}},{key:"getUri",value:function(e){z.getUri(e)}},{key:"getShowsPage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=t||0,"number"===typeof t){e.next=3;break}throw new TypeError("Invalid type, expected number, got ".concat(Object(I["a"])(t)));case 3:if(Number.isInteger(t)&&!(t<0)){e.next=5;break}throw new RangeError("Invalid value, expected positive integer");case 5:return e.next=7,this.get("shows?page=".concat(t));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),X=new V,Y=(r("f559"),r("74ce")),Z=new Y["a"]("ShowsDatabase");Z.version(3).stores({shows:"id,name,*nameWords,status,*genres,updated"}),Z.shows.hook("creating",function(e,t,r){"string"===typeof t.name&&(t.nameWords=A(t.name)),"string"===typeof t.thumbUrl&&t.thumbUrl.startsWith("http:")&&(t.thumbUrl="https"+t.thumbUrl.substring(4)),"string"===typeof t.imageUrl&&t.imageUrl.startsWith("http:")&&(t.imageUrl="https"+t.imageUrl.substring(4))}),Z.shows.hook("updating",function(e,t,r,n){var a={};return e.hasOwnProperty("name")&&("string"==typeof e.name?a.nameWords=A(e.name):a.nameWords=[]),e.hasOwnProperty("thumbUrl")&&"string"===typeof r.thumbUrl&&r.thumbUrl.startsWith("http:")&&(a.thumbUrl="https"+r.thumbUrl.substring(4)),e.hasOwnProperty("imageUrl")&&"string"===typeof r.imageUrl&&r.imageUrl.startsWith("http:")&&(a.imageUrl="https"+r.imageUrl.substring(4)),a});var ee=Z.shows.defineClass({id:Number,name:String,nameWords:[String],updated:Number,thumb:Blob,thumbUrl:String,imageUrl:String,type:String,summary:String,genres:[String]});ee.prototype.save=function(){return Z.shows.put(this)};var te=Z,re=r("0430"),ne=r.n(re);window.db=te;var ae=864e5,se=250,ue=function(){function e(){Object(T["a"])(this,e);var t=localStorage.getItem("lastUpdated")||"0",r=Number.parseInt(t);this._lastUpdated=new Date(r>0?r:0),N()-this.lastUpdated.getTime()>ae?this.refreshShows():this.getNewShows()}return Object(L["a"])(e,[{key:"searchTypingFirstWord",value:function(e){return te.shows.where("nameWords").startsWithIgnoreCase(e).distinct().toArray()}},{key:"searchLastCharSpace",value:function(e){return te.transaction("r","shows",Object(n["a"])(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map(function(e){return te.shows.where("nameWords").equalsIgnoreCase(e).distinct().primaryKeys()}));case 2:return r=t.sent,n=r.reduce(function(e,t){for(var r=[],n=0;n<e.length;n++)t.includes(e[n])&&r.push(e[n]);return r}),t.next=6,te.shows.where(":id").anyOf(n).toArray();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t)})))}},{key:"searchTypingMultipleWords",value:function(e,t){return te.transaction("r","shows",Object(n["a"])(regeneratorRuntime.mark(function r(){var n,a,s;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Promise.all(t.map(function(e){return te.shows.where("nameWords").equalsIgnoreCase(e).distinct().primaryKeys()}));case 2:return n=r.sent,r.next=5,te.shows.where("nameWords").startsWithIgnoreCase(e).distinct().primaryKeys();case 5:return a=r.sent,s=n.reduce(function(e,t){for(var r=[],n=0;n<e.length;n++)t.includes(e[n])&&r.push(e[n]);return r},a),r.next=9,te.shows.where(":id").anyOf(s).toArray();case 9:return r.abrupt("return",r.sent);case 10:case"end":return r.stop()}},r)})))}},{key:"search",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t,r){var n,a,s,u,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.split(" "),a=r?"":n.pop(),s=A(n.join(" ")),!a||s.length){e.next=9;break}return e.next=6,this.searchTypingFirstWord(a);case 6:u=e.sent,e.next=22;break;case 9:if(a||!s.length){e.next=15;break}return e.next=12,this.searchLastCharSpace(s);case 12:u=e.sent,e.next=22;break;case 15:if(!a||!s.length){e.next=21;break}return e.next=18,this.searchTypingMultipleWords(a,s);case 18:u=e.sent,e.next=22;break;case 21:return e.abrupt("return",[]);case 22:return i=t.toLowerCase(),e.abrupt("return",u.map(function(e){return{result:e,rating:ne.a.compareTwoStrings(e.name.toLowerCase(),i)}}).sort(function(e,t){return t.rating-e.rating}));case 24:case"end":return e.stop()}},e,this)}));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"parsePage",value:function(e,t){return te.transaction("rw",te.shows,Object(n["a"])(regeneratorRuntime.mark(function r(){var n,a,s,u,i,o,c;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return n=t*se,a=(t+1)*se,console.log(n,a),s=te.shows.where(":id").between(n,a),r.next=6,s.primaryKeys();case 6:u=r.sent,te.shows.bulkDelete(u.filter(function(t){return!e.find(function(e){return t===e.id})})),i=0;case 9:if(!(i<e.length)){r.next=32;break}return o=e[i],r.next=13,te.shows.get(o.id);case 13:if(r.t0=r.sent,r.t0){r.next=16;break}r.t0=new ee;case 16:if(c=r.t0,c.updated!==o.updated){r.next=19;break}return r.abrupt("continue",29);case 19:return c.id=o.id,c.name=o.name,c.updated=o.updated,c.imageUrl=o.image&&o.image.original,c.type=o.type,c.summary=o.summary,c.genres=e.genres,o.image&&o.image.medium&&c.thumbUrl!==o.image.medium&&(c.thumbUrl=o.image.medium,c.thumb=null),r.next=29,c.save();case 29:i++,r.next=9;break;case 32:case"end":return r.stop()}},r)})))}},{key:"refreshPage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=this,e.next=4,X.getShowsPage(t);case 4:return e.t1=e.sent.data,e.t2=t,e.next=8,e.t0.parsePage.call(e.t0,e.t1,e.t2);case 8:e.next=19;break;case 10:if(e.prev=10,e.t3=e["catch"](0),e.t3.isAxiosError){e.next=14;break}throw e.t3;case 14:if(e.t3.response){e.next=16;break}throw e.t3;case 16:if(404!==e.t3.response.status){e.next=18;break}return e.abrupt("return",!1);case 18:throw e.t3;case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}},e,this,[[0,10]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshFromId",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=t||0,r=Math.floor(t/se);case 2:return e.next=4,this.refreshPage(r);case 4:if(!e.sent){e.next=8;break}r++,e.next=2;break;case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshShows",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.refreshFromId();case 2:this.lastUpdated=new Date;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getNewShows",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,te.shows.orderBy(":id").last();case 2:return t=e.sent.id,e.next=5,this.refreshFromId(t);case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"useLocal",get:function(){return!1===navigator.onLine||N()-this.lastUpdated.getTime()<3*ae}},{key:"lastUpdated",get:function(){return this._lastUpdated},set:function(e){if(!(e instanceof Date))throw new TypeError("lastUpdated needs to be a Date");localStorage.setItem("lastUpdated",e.getTime()+""),this._lastUpdated=e}}]),e}(),ie=new ue,oe=r("b012"),ce=r.n(oe),le={name:"app",data:function(){return{hasFocus:!1,searchQuery:{term:"",results:[],time:0}}},components:{"search-results":Q},methods:{onfocus:function(){this.hasFocus=!0},onPageClick:function(e){e.target===this.$el||this.$el.contains(e.target)||(this.hasFocus=!1)},debounceInput:ce()(function(e){var t=this;e||(this.searchQuery.term=e,this.searchQuery.results=[]);var r=N();ie.search(e).then(function(n){t.searchQuery.term=e,t.searchQuery.results=n,t.searchQuery.time=N()-r})},800)},mounted:function(){document.addEventListener("click",this.onPageClick)},beforeDestroy:function(){document.removeEventListener("click",this.onPageClick)}},he=le,pe=Object(h["a"])(he,m,d,!1,null,null,null),fe=pe.exports,me=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v(" HI ")])},de=[],be={},ge=Object(h["a"])(be,me,de,!1,null,null,null),ve=ge.exports,we=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v("\n  404 not found. How did this happen?\n")])},ye=[],ke={},xe=Object(h["a"])(ke,we,ye,!1,null,null,null),Oe=xe.exports,je=[{path:"/",component:fe},{path:"/about",component:ve},{path:"*",component:Oe}],Ue=new s["a"]({routes:je});window.tvmc=ie,a["default"].use(s["a"]),a["default"].use(u["a"]),a["default"].config.productionTip=!1,new a["default"]({router:Ue,render:function(e){return e(f)},created:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}).$mount("#app")},9607:function(e,t,r){}});
//# sourceMappingURL=app.ca01ab3f.js.map