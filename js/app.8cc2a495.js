(function(e){function t(t){for(var n,i,o=t[0],u=t[1],c=t[2],h=0,p=[];h<o.length;h++)i=o[h],s[i]&&p.push(s[i][0]),s[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,o=1;o<r.length;o++){var u=r[o];0!==s[u]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},s={app:0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var l=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"56d7":function(e,t,r){"use strict";r.r(t);r("7f7f"),r("96cf");var n=r("3b8d"),s=(r("cadf"),r("551c"),r("f751"),r("097d"),r("baf5"),r("2b0e")),a=r("8c4f"),i=r("5f5b"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("b-container",[r("b-alert",{staticStyle:{"margin-top":"5px"},attrs:{show:e.isOffline,variant:"warning"}},[e._v("You are offline, functionality and data available will be limited.")]),r("b-navbar",{attrs:{toggleable:"md"}},[r("b-navbar-brand",{attrs:{to:"/"}},[r("img",{staticStyle:{height:"100px"},attrs:{src:"/static/img/logo_transparent.png",alt:"Linn's TV Search"}})]),r("b-navbar-toggle",{attrs:{target:"mainNav"}},[r("img",{attrs:{src:"/static/img/hamburger_icon.svg"}})]),r("b-collapse",{attrs:{"is-nav":"",id:"mainNav"}},[r("b-navbar-nav",[r("b-nav-item",{attrs:{to:"about"}},[e._v("About Us")]),r("b-nav-item",{staticClass:"nav-github-link",attrs:{href:"https://github.com/SimplyLinn/tvmaze-api-frontend"}},[r("img",{staticClass:"icon",attrs:{src:"/static/img/GitHub-Mark.png"}}),e._v(" Github")])],1)],1)],1),r("router-view")],1)],1)},u=[],c={name:"app",data:function(){return{isOffline:!1===navigator.onLine}},methods:{online:function(){this.isOffline=!1},offline:function(){this.isOffline=!0}},mounted:function(){window.addEventListener("online",this.online),window.addEventListener("offline",this.offline)},beforeDestroy:function(){window.removeEventListener("click",this.online),window.removeEventListener("offline",this.offline)}},l=c,h=r("2877"),p=Object(h["a"])(l,o,u,!1,null,null,null),d=p.exports,f=(r("9607"),r("8e6e"),r("ac6a"),r("456d"),r("bd86")),m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-row",[r("b-form-input",{staticClass:"searchForm",attrs:{autocomplete:"off",placeholder:"Search for series"},on:{input:e.debounceInput,focus:e.onfocus},model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}}),r("div",{staticClass:"searchResContainer"},[r("keep-alive",[e.hasFocus?r("search-results",{attrs:{searchQuery:e.searchQuery,searching:e.searching}}):e._e()],1)],1),r("router-view")],1)},b=[],g=(r("386d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{staticClass:"searchbox"},[e.searchQuery.term.length>=3?[r("b-row",{staticStyle:{"margin-bottom":"5px"}},[r("b-col",[e._v("Showing "+e._s(e.searchQuery.results.length+" result"+(1===e.searchQuery.results.length?"":"s"))+" for "),r("b",[e._v(e._s(e.searchQuery.term))]),e._v(" (query took "+e._s(e.searchQuery.time)+"ms)")])],1),r("result-list",{attrs:{results:e.searchQuery.results}})]:r("b-row",[e._v("\n    Type at least 3 characters to search.\n  ")]),e.searching?r("div",{staticClass:"searchBlur"}):e._e()],2)}),w=[],v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.results.length?r("div",[e._l(e.results,function(t,n){var s=t.result;return[r("result-entry",{key:s.id,attrs:{result:s}}),n<e.results.length-1?r("hr",{key:s.id+"hr"}):e._e()]})],2):r("div",[e._v("\n  NO RESULTS TO SHOW!\n")])},y=[],_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-row",{staticClass:"resultEntry",on:{click:e.clicked}},[r("b-col",{attrs:{cols:"3",sm:"2"}},[r("result-img",{staticStyle:{width:"100%"},attrs:{result:e.result}})],1),r("b-col",{attrs:{cols:"9",sm:"10"}},[e.result.premiered?[r("b-badge",[e._v(e._s(e.result.premiered.substring(0,4)))]),e._v(" ")]:e._e(),e.result.type?[r("b-badge",[e._v(e._s(e.result.type))]),e._v(" ")]:e._e(),e.result.status?[r("b-badge",{attrs:{variant:e.statusVariant}},[e._v(e._s(e.result.status))]),e._v(" ")]:e._e(),r("h5",[e._v(e._s(e.result.name)+" "),e.result.genres?[e._l(e.result.genres,function(t){return[r("b-badge",{key:e.result.id+t},[e._v(e._s(t))]),e._v(" ")]})]:e._e()],2),r("br"),r("span",[e._v(e._s(e.summaryText))])],2)],1)},x=[],k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("img",{attrs:{src:e.src,alt:e.result.name}})},O=[],S={name:"app",data:function(){return{src:"/static/img/logo_transparent.png"}},props:{result:Object},methods:{loadImage:function(e){var t=this;e=e||this.result,e.thumbUrl?e.thumb?this.src=URL.createObjectURL(e.thumb):fetch(e.thumbUrl).then(function(r){r.blob().then(function(r){t.src=URL.createObjectURL(r),e.thumb=r,e.save()})}).catch(function(e){t.src="/static/img/no-connection-show-thumb.png"}):this.src="/static/img/no-image-show-thumb.png"}},mounted:function(){this.loadImage()},watch:{result:function(e){this.loadImage(e)}}},j=S,E=Object(h["a"])(j,k,O,!1,null,null,null),R=E.exports,U=(r("a481"),r("75fc")),P=(r("28a5"),r("5df3"),r("4f7f"),r("d225")),C=r("308d"),L=r("6bb5"),T=r("4e2b"),D=r("f28b"),W=function(e){function t(){var e;return Object(P["a"])(this,t),e=Object(C["a"])(this,Object(L["a"])(t).call(this,"The search was cancelled.")),e.name=e.constructor.name,e}return Object(T["a"])(t,e),t}(Object(D["a"])(Error)),$=function(e){function t(){var e;return Object(P["a"])(this,t),e=Object(C["a"])(this,Object(L["a"])(t).call(this,"The resource was not found.")),e.name=e.constructor.name,e}return Object(T["a"])(t,e),t}(Object(D["a"])(Error));function F(e){return new Promise(function(t){return setTimeout(t,e)})}function I(){return(new Date).getTime()}function Q(e){var t=new Set;return e.toLowerCase().split(" ").forEach(function(e){return e&&t.add(e)}),Object(U["a"])(t)}function q(e,t,r,n){return M.apply(this,arguments)}function M(){return M=Object(n["a"])(regeneratorRuntime.mark(function e(t,r,n,s){var a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=n||20,a=[],i=0;case 3:if(!(i<t.length)){e.next=13;break}if(0===i||i%n!==0){e.next=9;break}return e.next=7,F(1);case 7:if(!s.isCancelled){e.next=9;break}throw new W;case 9:a.push(r(t[i],i,t));case 10:i++,e.next=3;break;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e)})),M.apply(this,arguments)}function N(e){var t=""+e;return t=t.replace(/<br>/gi,"\n"),t=t.replace(/<br\s\/>/gi,"\n"),t=t.replace(/<br\/>/gi,"\n"),t=t.replace(/<p.*?>/gi,"\n"),t=t.replace(/<a.*href="(.*?)".*>(.*?)<\/a>/gi," $2 ($1)"),t=t.replace(/<script.*>[\w\W]{1,}(.*?)[\w\W]{1,}<\/script>/gi,""),t=t.replace(/<style.*>[\w\W]{1,}(.*?)[\w\W]{1,}<\/style>/gi,""),t=t.replace(/<(?:.|\s)*?>/g,""),t=t.replace(/(?:(?:\r\n|\r|\n)\s*){2,}/gim,"\n\n"),t=t.replace(/ +(?= )/g,""),t=t.replace(/&nbsp;/gi," "),t=t.replace(/&amp;/gi,"&"),t=t.replace(/&quot;/gi,'"'),t=t.replace(/&lt;/gi,"<"),t=t.replace(/&gt;/gi,">"),t}var H=new s["default"],A=350,z={name:"app",data:function(){return{}},components:{"result-img":R},props:{result:Object},computed:{summaryText:function(){var e=N(this.result.summary);return e.length<A?e:e.substring(0,A-3)+"..."},statusVariant:function(){switch(this.result.status.toLowerCase()){case"running":return"success";case"ended":return"danger";case"in development":return"warning";default:return null}}},methods:{clicked:function(){H.$emit("closeSearch"),this.$router.push({name:"show",params:{id:this.result.id}})}}},B=z,V=Object(h["a"])(B,_,x,!1,null,null,null),K=V.exports,G={name:"app",data:function(){return{filterOpen:!1}},components:{"result-entry":K},props:{results:Array},computed:{sanitizedSummary:{get:function(){return sanitizeHtml(this.result.summary)}}},methods:{}},J=G,Y=Object(h["a"])(J,v,y,!1,null,null,null),X=Y.exports,Z={name:"app",data:function(){return{filterOpen:!1}},components:{"result-list":X},props:{searchQuery:Object,searching:Boolean},methods:{}},ee=Z,te=Object(h["a"])(ee,g,w,!1,null,null,null),re=te.exports,ne=(r("7514"),r("f559"),r("55dd"),r("6762"),r("2fdb"),r("c5f6"),r("04ff"),r("b0b4")),se=(r("7cdf"),r("7618")),ae=r("bc3a"),ie=r.n(ae);function oe(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(r,!0).forEach(function(t){Object(f["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ce=2e3,le=ie.a.create({baseURL:"https://api.tvmaze.com/",timeout:5e3}),he=[],pe=!1,de=function(){function e(){Object(P["a"])(this,e)}return Object(ne["a"])(e,[{key:"doRequest",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:r=0;case 1:return e.prev=2,e.next=5,le.request(t);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e["catch"](2),e.t0.isAxiosError){e.next=12;break}throw e.t0;case 12:if(e.t0.response){e.next=14;break}throw e.t0;case 14:if(429===e.t0.response.status){e.next=16;break}throw e.t0;case 16:if(n=Math.min(10*ce,Math.round(ce*Math.pow(1.5,r))),r++,!(this.maxRetries&&r>=this.maxRetries)){e.next=20;break}throw e.t0;case 20:return console.log("We got ratelimited, waiting ".concat(n,"ms. We have tried ").concat(r," times.")),e.next=23,F(n);case 23:e.next=1;break;case 25:case"end":return e.stop()}},e,this,[[2,8]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"runQueue",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,r,n,s,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(pe=!0,he.length){e.next=4;break}return pe=!1,e.abrupt("return");case 4:t=he.pop(),r=t.config,n=t.resolve,s=t.reject,this.doRequest(r).then(n).catch(s).finally(function(){return a.runQueue()});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"request",value:function(e){var t=this,r=!1;return e.hasOwnProperty("priority")&&(r=e.priority,delete e.priority),new Promise(function(n,s){he[r?"push":"unshift"]({config:e,resolve:n,reject:s}),pe||t.runQueue()})}},{key:"get",value:function(e,t){return this.request(ue({url:e,method:"get"},t||{}))}},{key:"delete",value:function(e,t){return this.request(ue({url:e,method:"delete"},t||{}))}},{key:"head",value:function(e,t){return this.request(ue({url:e,method:"head"},t||{}))}},{key:"options",value:function(e,t){return this.request(ue({url:e,method:"options"},t||{}))}},{key:"post",value:function(e,t,r){return this.request(ue({url:e,method:"post",data:t},r||{}))}},{key:"put",value:function(e,t,r){return this.request(ue({url:e,method:"put",data:t},r||{}))}},{key:"patch",value:function(e,t,r){return this.request(ue({url:e,method:"patch",data:t},r||{}))}},{key:"getUri",value:function(e){le.getUri(e)}},{key:"getShowsPage",value:function(e){if(e=e||0,"number"!==typeof e)throw new TypeError("Invalid type, expected number, got ".concat(Object(se["a"])(e)));if(!Number.isInteger(e)||e<0)throw new RangeError("Invalid value, expected positive integer");return this.get("shows?page=".concat(e))}},{key:"getEpisodes",value:function(e){return this.get("shows/".concat(+e,"/episodes"))}},{key:"getSingleShow",value:function(e){return this.get("shows/".concat(+e))}}]),e}(),fe=new de,me=r("74ce"),be=new me["a"]("ShowsDatabase");be.version(9).stores({shows:"id,*nameWords"});var ge=be.shows.defineClass({id:Number,name:String,nameWords:[String],premiered:String,updated:Number,thumb:Blob,thumbUrl:String,imageUrl:String,type:String,summary:String,genres:[String],episodes:[{name:String,season:Number,number:Number,summary:String,thumb:null,thumbUrl:String,imageUrl:String,airstamp:Date}],episodesFetched:Date});ge.prototype.save=function(){return be.shows.put(this)};var we=be,ve=r("0430"),ye=r.n(ve);window.db=we;var _e=864e5,xe=36e5,ke=250,Oe=function(){function e(){Object(P["a"])(this,e);var t=localStorage.getItem("lastUpdated")||"0",r=Number.parseInt(t);this._lastUpdated=new Date(r>0?r:0),this.doRefresh()}return Object(ne["a"])(e,[{key:"doRefresh",value:function(){I()-this.lastUpdated.getTime()>_e?this.refreshShows():I()-this.lastUpdated.getTime()>xe&&this.getNewShows()}},{key:"searchTypingFirstWord",value:function(e){return we.shows.where("nameWords").startsWithIgnoreCase(e).distinct().toArray()}},{key:"searchPromises",value:function(e,t){return we.transaction("r","shows",Object(n["a"])(regeneratorRuntime.mark(function r(){var n,s,a;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Promise.all(e);case 2:if(n=r.sent,!t||!t.isCancelled){r.next=5;break}throw new W;case 5:if(n.length){r.next=7;break}return r.abrupt("return",[]);case 7:return s=n.reduce(function(e,t){for(var r=[],n=0;n<e.length;n++)t.includes(e[n])&&r.push(e[n]);return r}),r.next=10,we.shows.where(":id").anyOf(s).toArray();case 10:if(a=r.sent,!t||!t.isCancelled){r.next=13;break}throw new W;case 13:return r.abrupt("return",a);case 14:case"end":return r.stop()}},r)})))}},{key:"searchLastCharSpace",value:function(e,t){var r=this;return we.transaction("r","shows",function(){return r.searchPromises(e.map(function(e){return we.shows.where("nameWords").equalsIgnoreCase(e).distinct().primaryKeys()}))})}},{key:"searchTypingMultipleWords",value:function(e,t,r){var n=this;return we.transaction("r","shows",function(){return n.searchPromises([].concat(Object(U["a"])(t.map(function(e){return we.shows.where("nameWords").equalsIgnoreCase(e).distinct().primaryKeys()})),[we.shows.where("nameWords").startsWithIgnoreCase(e).distinct().primaryKeys()]),r)})}},{key:"search",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t,r){var n,s,a,i,o,u,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n={isCancelled:!1},"function"===typeof r&&r(function(){n.isCancelled=!0}),s=t.split(" "),a=s.pop(),i=Q(s.join(" ")),!a||i.length){e.next=11;break}return e.next=8,this.searchTypingFirstWord(a,n);case 8:o=e.sent,e.next=24;break;case 11:if(a||!i.length){e.next=17;break}return e.next=14,this.searchLastCharSpace(i,n);case 14:o=e.sent,e.next=24;break;case 17:if(!a||!i.length){e.next=23;break}return e.next=20,this.searchTypingMultipleWords(a,i,n);case 20:o=e.sent,e.next=24;break;case 23:return e.abrupt("return",[]);case 24:return u=t.toLowerCase(),e.next=27,q(o,function(e){return{result:e,rating:ye.a.compareTwoStrings(e.name.toLowerCase(),u)}},n);case 27:if(e.t0=function(e,t){return t.rating-e.rating},c=e.sent.sort(e.t0),!n.isCancelled){e.next=31;break}throw new W;case 31:return e.abrupt("return",c);case 32:case"end":return e.stop()}},e,this)}));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"parseShow",value:function(e){return we.transaction("rw",we.shows,Object(n["a"])(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,we.shows.get(e.id);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=new ge;case 5:if(r=t.t0,r.updated!==e.updated){t.next=8;break}return t.abrupt("return",r);case 8:return r.id=e.id,r.name=e.name,r.updated=e.updated,r.premiered=e.premiered,r.imageUrl=e.image&&e.image.original,r.type=e.type,r.status=e.status,r.summary=e.summary,r.genres=e.genres,e.image&&e.image.medium&&r.thumbUrl!==e.image.medium&&(r.thumbUrl=e.image.medium,r.thumb=null),"string"===typeof r.name&&(r.nameWords=Q(r.name)),"string"===typeof r.thumbUrl&&r.thumbUrl.startsWith("http:")&&(r.thumbUrl="https"+r.thumbUrl.substring(4)),"string"===typeof r.imageUrl&&r.imageUrl.startsWith("http:")&&(r.imageUrl="https"+r.imageUrl.substring(4)),t.next=23,r.save();case 23:return t.abrupt("return",r);case 24:case"end":return t.stop()}},t)})))}},{key:"parsePage",value:function(e,t){var r=this;return we.transaction("rw",we.shows,Object(n["a"])(regeneratorRuntime.mark(function n(){var s,a,i,o,u;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return s=t*ke,a=(t+1)*ke,console.log(s,a),i=we.shows.where(":id").between(s,a),n.next=6,i.primaryKeys();case 6:o=n.sent,we.shows.bulkDelete(o.filter(function(t){return!e.find(function(e){return t===e.id})})),u=0;case 9:if(!(u<e.length)){n.next=15;break}return n.next=12,r.parseShow(e[u]);case 12:u++,n.next=9;break;case 15:case"end":return n.stop()}},n)})))}},{key:"refreshPage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=this,e.next=4,fe.getShowsPage(t);case 4:return e.t1=e.sent.data,e.t2=t,e.next=8,e.t0.parsePage.call(e.t0,e.t1,e.t2);case 8:e.next=19;break;case 10:if(e.prev=10,e.t3=e["catch"](0),e.t3.isAxiosError){e.next=14;break}throw e.t3;case 14:if(e.t3.response){e.next=16;break}throw e.t3;case 16:if(404!==e.t3.response.status){e.next=18;break}return e.abrupt("return",!1);case 18:throw e.t3;case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}},e,this,[[0,10]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshFromId",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=t||0,r=Math.floor(t/ke);case 2:return e.next=4,this.refreshPage(r);case 4:if(!e.sent){e.next=8;break}r++,e.next=2;break;case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshShows",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.refreshFromId();case 2:this.lastUpdated=new Date;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getNewShows",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,we.shows.orderBy(":id").last();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={id:0};case 5:return t=e.t0.id,e.next=8,this.refreshFromId(t);case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getShow",value:function(e){var t=this;return we.transaction("rw","shows",Object(n["a"])(regeneratorRuntime.mark(function r(){var n,s;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,we.shows.get(e).catch(function(e){throw console.log("yup, this fails"),e});case 2:if(n=r.sent,n){r.next=19;break}return r.prev=4,r.t0=t,r.next=8,me["a"].waitFor(fe.getSingleShow(e));case 8:return r.t1=r.sent.data,r.next=11,r.t0.parseShow.call(r.t0,r.t1);case 11:n=r.sent,r.next=19;break;case 14:if(r.prev=14,r.t2=r["catch"](4),!r.t2.response||404!==r.t2.response.status){r.next=18;break}throw new $;case 18:throw r.t2;case 19:if(!(!1===navigator.onLine||n.episodesFetched&&I()-n.episodesFetched.getTime()<_e)){r.next=21;break}return r.abrupt("return",n);case 21:return r.next=23,me["a"].waitFor(fe.getEpisodes(e));case 23:return r.t3=function(e){return e.image&&"string"===typeof e.image.medium&&e.image.medium.startsWith("http:")&&(e.image.medium="https"+e.image.medium.substring(4)),e.image&&"string"===typeof e.image.original&&e.image.original.startsWith("http:")&&(e.image.original="https"+e.image.original.substring(4)),{name:e.name,season:e.season,number:e.number,summary:e.summary,thumb:null,thumbUrl:e.image&&e.image.medium,imageUrl:e.image&&e.image.original,airdate:e.airdate}},s=r.sent.data.map(r.t3),n.episodes=s,n.episodesFetched=new Date,r.next=29,n.save();case 29:return r.abrupt("return",n);case 30:case"end":return r.stop()}},r,null,[[4,14]])})))}},{key:"lastUpdated",get:function(){return this._lastUpdated},set:function(e){if(!(e instanceof Date))throw new TypeError("lastUpdated needs to be a Date");localStorage.setItem("lastUpdated",e.getTime()+""),this._lastUpdated=e}}]),e}(),Se=new Oe;window.addEventListener("online",function(){Se.doRefresh()});var je=Se,Ee=r("b012"),Re=r.n(Ee),Ue={name:"app",data:function(){return{hasFocus:!1,searchQuery:{term:"",results:[],time:0},searching:!1,searchTerm:"",cancelFunc:null,busHandler:null}},components:{"search-results":re},methods:{onCloseSearch:function(){this.hasFocus=!1},onfocus:function(){this.hasFocus=!0},onPageClick:function(e){e.target===this.$el||this.$el.contains(e.target)||(this.hasFocus=!1)},debounceInput:Re()(function(e){this.doSearch(e)},100),doSearch:function(e){var t=this;if(e=" "===e[e.length-1]?e.trim()+" ":e.trim(),this.cancelSearch&&(this.cancelSearch(),this.cancelSearch=null),e.length<3)return this.searchQuery.term=e,this.searchQuery.results=[],void(this.searchQuery.time=0);var r=I();this.searching=!0,je.search(e,function(e){return t.cancelSearch=e}).then(function(n){t.cancelSearch=null,t.searching=!1,t.searchQuery.term=e,t.searchQuery.results=n,t.searchQuery.time=I()-r}).catch(function(e){if(!(e instanceof W))throw t.searching=!1,e})}},mounted:function(){var e=this;document.addEventListener("click",this.onPageClick),this.busHandler=function(){return e.onCloseSearch()},H.$on("closeSearch",this.busHandler)},beforeDestroy:function(){document.removeEventListener("click",this.onPageClick),H.$off("closeSearch",this.busHandler),this.busHandler=null}},Pe=Ue,Ce=Object(h["a"])(Pe,m,b,!1,null,null,null),Le=Ce.exports,Te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v(" HI ")])},De=[],We={},$e=Object(h["a"])(We,Te,De,!1,null,null,null),Fe=$e.exports,Ie=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v("\n  404 not found. How did this happen?\n")])},Qe=[],qe={},Me=Object(h["a"])(qe,Ie,Qe,!1,null,null,null),Ne=Me.exports,He=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v("\n  Search above and click on a show to view details.\n")])},Ae=[],ze={},Be=Object(h["a"])(ze,He,Ae,!1,null,null,null),Ve=Be.exports,Ke=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.show?r("b-container",{staticStyle:{"margin-top":"1em"}},[r("b-row",[r("b-col",{attrs:{cols:"3",sm:"2"}},[r("result-img",{staticStyle:{width:"100%"},attrs:{result:e.show}})],1),r("b-col",{attrs:{cols:"9",sm:"10"}},[e.show.premiered?[r("b-badge",[e._v(e._s(e.show.premiered.substring(0,4)))]),e._v(" ")]:e._e(),e.show.type?[r("b-badge",[e._v(e._s(e.show.type))]),e._v(" ")]:e._e(),e.show.status?[r("b-badge",{attrs:{variant:e.statusVariant}},[e._v(e._s(e.show.status))]),e._v(" ")]:e._e(),r("h4",[e._v(e._s(e.show.name)+" "),e.show.genres?[e._l(e.show.genres,function(t){return[r("b-badge",{key:e.show.id+t},[e._v(e._s(t))]),e._v(" ")]})]:e._e()],2),r("br"),r("span",[e._v(e._s(e.summaryText))])],2)],1),r("hr"),e.show.episodesFetched?r("div",[e._l(e.seasons,function(t,n){return[t?r("b-row",{key:e.show.id+"s"+n},[r("b-col",[r("h5",[e._v("Season "+e._s(n+1))])])],1):e._e(),t?r("div",{key:e.show.id+"s"+n+"list"},[r("b-list-group",e._l(t,function(t){return r("b-list-group-item",{key:e.show.id+"s"+n+"e"+t.number,attrs:{button:""},on:{click:function(r){return e.routeEpisode(t.season,t.number)}}},[r("episode-img",{attrs:{show:e.show,episode:t}}),r("span",{staticStyle:{position:"absolute",top:".5em"}},[e._v("S"+e._s(e.pad(t.season))+"E"+e._s(e.pad(t.number)))]),r("b",[e._v(e._s(t.name))])],1)}),1)],1):e._e(),t&&n<e.seasons.length-1?r("hr",{key:e.show.id+"s"+n+"hr"}):e._e()]})],2):e.isOffline?r("div",[e._v("\n    Episode data unavailable while offline.\n  ")]):r("div",[e._v("\n    There are no episodes to show.\n  ")]),r("b-modal",{ref:"episode-modal",attrs:{size:"lg",visible:!!e.selectedEpisode,centered:""},on:{hidden:e.closeEpisode}},[e.selectedEpisode?[r("episode-img",{staticClass:"float-left",attrs:{show:e.show,episode:e.selectedEpisode}}),e._v("\n      "+e._s(e.episodeText)+"\n    ")]:e._e(),e.selectedEpisode?r("div",{attrs:{slot:"modal-title"},slot:"modal-title"},[e._v("\n      "+e._s(e.selectedEpisode.name)+" "),r("b-badge",[e._v("S"+e._s(e.pad(e.selectedEpisode.season))+"E"+e._s(e.pad(e.selectedEpisode.number)))])],1):e._e(),e.selectedEpisode?r("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[e.selectedEpisode.airdate?r("p",{staticClass:"float-left"},[e._v("Aired: "+e._s(e.selectedEpisode.airdate))]):e._e(),r("b-button",{staticClass:"float-right",attrs:{variant:"danger",size:"sm"},on:{click:e.hideModal}},[e._v("\n          Close\n      ")])],1):e._e()],2)],1):e.isOffline?r("div",[e._v("\n  You are offline and this show is not in the local database.\n")]):e._e()},Ge=[],Je=(r("f576"),r("4917"),r("768b")),Ye=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("img",{staticStyle:{"margin-right":"1em"},attrs:{src:e.src,alt:e.episode.name}})},Xe=[],Ze={name:"app",data:function(){return{src:"/static/img/logo_transparent.png"}},props:{show:Object,episode:Object},methods:{},mounted:function(){var e=this,t=this.episode;t.thumbUrl?t.thumb?this.src=URL.createObjectURL(t.thumb):fetch(t.thumbUrl).then(function(r){r.blob().then(function(r){e.src=URL.createObjectURL(r),t.thumb=r,e.show.save()})}).catch(function(t){e.src="/static/img/no-connection-episode-thumb.png"}):this.src="/static/img/no-image-episode-thumb.png"}},et=Ze,tt=Object(h["a"])(et,Ye,Xe,!1,null,null,null),rt=tt.exports,nt={name:"app",data:function(){return{show:null,isOffline:!1===navigator.onLine}},components:{"result-img":R,"episode-img":rt},props:{id:Number,episode:String},computed:{summaryText:function(){var e=N(this.show.summary);return e},statusVariant:function(){switch(this.show.status.toLowerCase()){case"running":return"success";case"ended":return"danger";case"in development":return"warning";default:return null}},seasons:function(){if(!this.show.episodes)return[];var e=[];return this.show.episodes.forEach(function(t){var r=t.season-1;Array.isArray(e[r])||(e[r]=[]),e[r].push(t)}),e.forEach(function(e){return e.sort(function(e,t){return e.number-t.number})}),e},selectedEpisode:function(){if(!this.episode)return null;try{var e=this.episode.match(/S(\d{2,})E(\d{2,})/),t=Object(Je["a"])(e,3),r=t[1],n=t[2];return r--,n=+n,this.seasons[r].find(function(e){return e.number===n})}catch(s){return console.error(s),null}},episodeText:function(){if(!this.selectedEpisode)return"";var e=N(this.selectedEpisode.summary);return e}},methods:{fetchShow:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("Fetching show: ".concat(t," (").concat(Object(se["a"])(t),")")),e.prev=1,e.next=4,je.getShow(t);case 4:this.show=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),console.error(e.t0);case 10:case"end":return e.stop()}},e,this,[[1,7]])}));function t(t){return e.apply(this,arguments)}return t}(),pad:function(e,t,r){return t=t||2,r=r||"0",String(e).padStart(t,r)},routeEpisode:function(e,t){var r="S".concat(this.pad(e),"E").concat(this.pad(t));this.$router.push({name:"show",params:{id:this.show.id,episode:r}})},closeEpisode:function(){this.$router.push({name:"show",params:{id:this.show.id}})},hideModal:function(){this.$refs["episode-modal"].hide()},online:function(){this.isOffline=!1,this.show&&this.show.episodes||this.fetchShow(this.id)},offline:function(){this.isOffline=!0}},watch:{id:function(e,t){t!==e&&this.fetchShow(e)}},mounted:function(){window.addEventListener("online",this.online),window.addEventListener("offline",this.offline),this.fetchShow(this.id)},beforeDestroy:function(){window.removeEventListener("click",this.online),window.removeEventListener("offline",this.offline)}},st=nt,at=Object(h["a"])(st,Ke,Ge,!1,null,null,null),it=at.exports;function ot(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function ut(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ot(r,!0).forEach(function(t){Object(f["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ot(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ct=[{path:"/about",component:Fe},{path:"/",component:Le,children:[{name:"show",path:":id/:episode?",component:it,props:function(e){var t=ut({},e.params);return t.id=+t.id,t}},{path:"/",component:Ve}]},{path:"*",component:Ne}],lt=new a["a"]({routes:ct});window.tvmc=je,s["default"].use(a["a"]),s["default"].use(i["a"]),s["default"].config.productionTip=!1,we.open().then(function(){console.log("db opened"),new s["default"]({router:lt,render:function(e){return e(d)},created:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}).$mount("#app")}).catch(me["a"].UpgradeError,function(e){localStorage.removeItem("lastUpdated"),window.indexedDB.databases().then(function(e){for(var t=0;t<e.length;t++)window.indexedDB.deleteDatabase(e[t].name)}).then(function(){alert("New database version, refreshing page."),location.reload()})})},9607:function(e,t,r){}});
//# sourceMappingURL=app.8cc2a495.js.map